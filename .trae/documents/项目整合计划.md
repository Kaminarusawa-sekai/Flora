# 项目整合计划

## 1. 修复CapabilityRegistry中的bug

**问题**：CapabilityRegistry同时使用了`_factories`和`_capabilities`两个变量，导致部分方法无法正常工作

**解决方案**：统一使用`_factories`变量，修复`get_all_capabilities`、`unregister`等方法

## 2. 创建统一的初始化入口

**目标**：创建一个`init_plugins.py`文件，注册所有能力插件

**内容**：
- 注册路由能力（task_router, task_planner）
- 注册并行优化能力
- 注册结果聚合能力
- 注册其他必要的能力组件

## 3. 完善AgentActor的任务处理流程

**目标**：确保AgentActor能正确调用各个模块

**内容**：
- 修复`_plan_subtasks`方法，使用实际的TaskPlanner
- 修复`_dispatch_subtasks`方法，使用正确的Actor类
- 完善循环任务的处理逻辑
- 确保并行执行和结果聚合的正确调用

## 4. 补充事件通知逻辑

**目标**：确保任务状态变化时能发送事件

**内容**：
- 在任务创建、开始、完成、失败等关键节点发送事件
- 确保事件包含必要的任务信息
- 注册事件订阅者，处理任务事件

## 5. 确保循环任务功能正确集成

**目标**：确保循环任务能正确注册、执行和管理

**内容**：
- 修复LoopSchedulerActor中的bug（使用了不存在的`repo`变量）
- 确保RabbitMQ桥接器能正确工作
- 完善循环任务的自优化逻辑

## 6. 完善并行执行和优化功能

**目标**：确保并行执行和优化功能正确集成

**内容**：
- 修复ParallelTaskAggregatorActor中的依赖问题
- 确保TaskExecutionService能正确调用并行执行
- 完善并行优化的接口实现

## 7. 测试整合后的系统

**目标**：确保整合后的系统能正常工作

**内容**：
- 编写测试用例，测试完整的任务流程
- 测试循环任务的创建和执行
- 测试并行执行和结果聚合
- 测试事件通知功能

## 8. 优化代码结构和依赖关系

**目标**：优化代码结构，减少依赖关系

**内容**：
- 移除不必要的依赖
- 优化模块间的调用关系
- 确保代码符合项目的架构设计

## 执行顺序

1. 修复CapabilityRegistry中的bug
2. 创建统一的初始化入口
3. 完善AgentActor的任务处理流程
4. 补充事件通知逻辑
5. 确保循环任务功能正确集成
6. 完善并行执行和优化功能
7. 测试整合后的系统
8. 优化代码结构和依赖关系